<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Query Class | Vuex ORM</title>
    <meta name="description" content="The Vuex plugin to enable Object-Relational Mapping access to the Vuex Store.">
    
    
    <link rel="preload" href="/vuex-orm/assets/css/0.styles.441d591c.css" as="style"><link rel="preload" href="/vuex-orm/assets/js/app.8a3f6adc.js" as="script"><link rel="preload" href="/vuex-orm/assets/js/10.a558686d.js" as="script"><link rel="prefetch" href="/vuex-orm/assets/js/12.070884e6.js"><link rel="prefetch" href="/vuex-orm/assets/js/1.48a6f13e.js"><link rel="prefetch" href="/vuex-orm/assets/js/2.5bbe4682.js"><link rel="prefetch" href="/vuex-orm/assets/js/3.b686d34a.js"><link rel="prefetch" href="/vuex-orm/assets/js/4.2bf015fb.js"><link rel="prefetch" href="/vuex-orm/assets/js/5.5dfb11b5.js"><link rel="prefetch" href="/vuex-orm/assets/js/6.939443f4.js"><link rel="prefetch" href="/vuex-orm/assets/js/7.42acd46d.js"><link rel="prefetch" href="/vuex-orm/assets/js/8.d83dd84d.js"><link rel="prefetch" href="/vuex-orm/assets/js/9.2501e139.js"><link rel="prefetch" href="/vuex-orm/assets/js/11.6f1c899f.js"><link rel="prefetch" href="/vuex-orm/assets/js/13.80662db3.js"><link rel="prefetch" href="/vuex-orm/assets/js/14.fa9433f3.js"><link rel="prefetch" href="/vuex-orm/assets/js/15.d7f862c7.js"><link rel="prefetch" href="/vuex-orm/assets/js/16.5e5e6d1b.js"><link rel="prefetch" href="/vuex-orm/assets/js/17.9ff2d5a4.js"><link rel="prefetch" href="/vuex-orm/assets/js/18.1f8f0514.js"><link rel="prefetch" href="/vuex-orm/assets/js/19.9efc8792.js"><link rel="prefetch" href="/vuex-orm/assets/js/20.466d89da.js"><link rel="prefetch" href="/vuex-orm/assets/js/21.35ed0d2a.js"><link rel="prefetch" href="/vuex-orm/assets/js/22.23a66e02.js"><link rel="prefetch" href="/vuex-orm/assets/js/23.a3279e7c.js"><link rel="prefetch" href="/vuex-orm/assets/js/24.97e864de.js">
    <link rel="stylesheet" href="/vuex-orm/assets/css/0.styles.441d591c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuex-orm/" class="home-link router-link-active"><!----> <span class="site-name">Vuex ORM</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuex-orm/guide/prologue/what-is-vuex-orm.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/vuex-orm/api/model.html" class="nav-link">API Reference</a></div><div class="nav-item"><a href="https://github.com/vuex-orm/vuex-orm/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Release Notes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vuex-orm/vuex-orm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuex-orm/guide/prologue/what-is-vuex-orm.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/vuex-orm/api/model.html" class="nav-link">API Reference</a></div><div class="nav-item"><a href="https://github.com/vuex-orm/vuex-orm/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Release Notes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vuex-orm/vuex-orm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Prologue</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuex-orm/guide/prologue/what-is-vuex-orm.html" class="sidebar-link">What Is Vuex ORM?</a></li><li><a href="/vuex-orm/guide/prologue/installation.html" class="sidebar-link">Installation</a></li><li><a href="/vuex-orm/guide/prologue/getting-started.html" class="sidebar-link">Getting Started</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Core Components</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuex-orm/guide/components/models.html" class="sidebar-link">Models</a></li><li><a href="/vuex-orm/guide/components/modules-and-store.html" class="sidebar-link">Modules And Store</a></li><li><a href="/vuex-orm/guide/components/database-and-registration.html" class="sidebar-link">Database And Registration</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Interacting With Store</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuex-orm/guide/store/inserting-and-updating-data.html" class="sidebar-link">Inserting And Updating Data</a></li><li><a href="/vuex-orm/guide/store/retrieving-data.html" class="sidebar-link">Retrieving Data</a></li><li><a href="/vuex-orm/guide/store/deleting-data.html" class="sidebar-link">Deleting Data</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Relationships</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuex-orm/guide/relationships/defining-relationships.html" class="sidebar-link">Defining Relationships</a></li><li><a href="/vuex-orm/guide/relationships/inserting-relationships.html" class="sidebar-link">Inserting Relationships</a></li><li><a href="/vuex-orm/guide/relationships/retrieving-relationships.html" class="sidebar-link">Retrieving Relationships</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Advanced Usage</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuex-orm/guide/advanced/interact-with-store-from-model.html" class="sidebar-link">Interact With Store From Model</a></li><li><a href="/vuex-orm/guide/advanced/accessors-and-mutators.html" class="sidebar-link">Accessors &amp; Mutators</a></li><li><a href="/vuex-orm/guide/advanced/lifecycle-hooks.html" class="sidebar-link">Lifecycle Hooks</a></li><li><a href="/vuex-orm/guide/advanced/serialization.html" class="sidebar-link">Serialization</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Digging Deeper</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vuex-orm/guide/digging-deeper/query-class.html" class="active sidebar-link">Query Class</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuex-orm/guide/digging-deeper/query-class.html#lifecycle-hook-types" class="sidebar-link">Lifecycle Hook Types</a></li></ul></li><li><a href="/vuex-orm/guide/digging-deeper/plugins.html" class="sidebar-link">Plugins</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="query-class"><a href="#query-class" aria-hidden="true" class="header-anchor">#</a> Query Class</h1> <p>Query class is responsible for fetching data from Vuex Store. When you fetch data through Vuex getters such as <code>store.getters['entities/users/find'](1)</code>, it's using the Query class underneath to find and filter data.</p> <p>Usually, you won't need to care about Query class as long as you keep using getters. However, when you would like to add global features when querying data, it might be useful to use lifecycle hook. This is especially useful when you want to create a plugin for the Vuex ORM.</p> <h2 id="lifecycle-hook-types"><a href="#lifecycle-hook-types" aria-hidden="true" class="header-anchor">#</a> Lifecycle Hook Types</h2> <p>Query class comes with following lifecycle hooks.</p> <ul><li><code>beforeProcess</code> – Called before data get filtered.</li> <li><code>afterWhere</code> – Called right after the data get filtered by <code>where</code> clause.</li> <li><code>afterOrderBy</code> – Called right after the data get sorted by <code>orderBy</code> clause.</li> <li><code>afterLimit</code> – Called right after the data get limited by <code>limit</code> and <code>offset</code> clause.</li></ul> <p>By registering callbacks to each hook, you can manipulate the result from the getter call.</p> <h3 id="lifecycle-hook-methods"><a href="#lifecycle-hook-methods" aria-hidden="true" class="header-anchor">#</a> Lifecycle Hook Methods</h3> <p>Like javascript events, you can use the <strong>Query.on()</strong> to register a hook, and <strong>Query.off()</strong> to remove the hook.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hookId <span class="token operator">=</span> Query<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'afterWhere'</span><span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

Query<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>hookId<span class="token punctuation">)</span>
</code></pre></div><h4 id="lifecycle-hook-scope"><a href="#lifecycle-hook-scope" aria-hidden="true" class="header-anchor">#</a> Lifecycle Hook Scope</h4> <p>By default, all hooks are registered globally within the Query class and ran on all instances within your application.</p> <p>If you only want to register a hook to be available for the next query() call, you can add the third optional parameter <strong>true</strong> to have the Query class automatically remove your hook after the next query() method call.</p> <div class="language-js extra-class"><pre class="language-js"><code>Query<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'beforeProcess'</span><span class="token punctuation">,</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="lifecycle-api"><a href="#lifecycle-api" aria-hidden="true" class="header-anchor">#</a> Lifecycle API</h3> <p><strong>Query.on</strong>(type, callback, once?): hookId: number</p> <ul><li><code>type</code> (string) - must be one of [beforeProcess, afterWhere, afterOrderBy, afterLimit]</li> <li><code>callback</code> (function) - must be function</li> <li><code>once</code> (boolean, optional) - default false</li></ul> <p><strong>Returns</strong>: number: &lt; HookId &gt;</p> <h3 id="examples"><a href="#examples" aria-hidden="true" class="header-anchor">#</a> Examples</h3> <p><strong>Register a beforeProcess hook to map all records</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex-orm/core'</span>

<span class="token comment">// Add extra `hooked` field on each record.</span>
<span class="token keyword">const</span> hookMapRecordsId <span class="token operator">=</span> Query<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'beforeProcess'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>records<span class="token punctuation">,</span> entity<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> records<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    record<span class="token punctuation">.</span>hooked <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">return</span> record
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">'entities/users/all'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/* result
  [
    { id: 1, name: 'John Doe', hooked: true },
    { id: 2, name: 'Jane Doe', hooked: true }
  ]
*/</span>

<span class="token keyword">const</span> hookRemoved <span class="token operator">=</span> Query<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>hookMapRecordsId<span class="token punctuation">)</span>

<span class="token comment">/* hookRemoved = true */</span>
</code></pre></div><p><strong>Soft Delete Hook Sample Implementation</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex-orm/core'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> deletedAt<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Bob Doe'</span><span class="token punctuation">,</span> deletedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'entities/users/create'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> softDeleteHookId

<span class="token keyword">const</span> <span class="token function-variable function">softDeleteCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>records<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> records<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token operator">!</span>r<span class="token punctuation">.</span>deletedAt<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">deletedRecordsCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>records<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> records<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>r <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>r<span class="token punctuation">.</span>deletedAt<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// register global hook</span>
softDeleteHookId <span class="token operator">=</span> Query<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'beforeProcess'</span><span class="token punctuation">,</span> softDeleteCallback<span class="token punctuation">)</span>

<span class="token comment">// query data</span>
<span class="token keyword">const</span> results <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">'entities/users/query'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">/* results
[{ id: 1, name: 'John Doe', deletedAt: null }]
 */</span>

<span class="token comment">// *** switch to showing only deleted items **</span>
Query<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>softDeleteHookId<span class="token punctuation">)</span> <span class="token comment">// remove global callback</span>
Query<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'beforeProcess'</span><span class="token punctuation">,</span> deletedRecordsCallback<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// run only once</span>

<span class="token keyword">const</span> deletedResults <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">[</span><span class="token string">'entities/users/query'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">/* deletedResults
[{ id: 2, name: 'Bob Doe', deletedAt: '2018-03-15TZ00:00:00' }]
 */</span>

<span class="token comment">// re-initialize global soft deletes</span>
softDeleteHookId <span class="token operator">=</span> Query<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'beforeProcess'</span><span class="token punctuation">,</span> softDeleteCallback<span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vuex-orm/guide/advanced/serialization.html" class="prev">
          Serialization
        </a></span> <span class="next"><a href="/vuex-orm/guide/digging-deeper/plugins.html">
          Plugins
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/vuex-orm/assets/js/10.a558686d.js" defer></script><script src="/vuex-orm/assets/js/app.8a3f6adc.js" defer></script>
  </body>
</html>
